<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Presas Expostas â€” Ficha do Player</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
  background:#0b0b0b;
  color:#eaeaea;
  font-family: monospace;
  padding:20px;
}

input, textarea, button {
  width:100%;
  margin:5px 0;
  padding:8px;
  background:#111;
  color:#fff;
  border:1px solid #400;
}

button { cursor:pointer; }
.hidden { display:none; }
h2 { color:#b00; }

/* ðŸŽ² DADO 3D */
.scene {
  width:80px;
  height:80px;
  perspective:600px;
  margin:10px auto;
}

.cube {
  width:100%;
  height:100%;
  position:relative;
  transform-style:preserve-3d;
  transition:transform 1s;
}

.face {
  position:absolute;
  width:80px;
  height:80px;
  background:#111;
  border:2px solid #800;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:32px;
}

.face1 { transform: rotateY(0deg) translateZ(40px); }
.face2 { transform: rotateY(90deg) translateZ(40px); }
.face3 { transform: rotateY(180deg) translateZ(40px); }
.face4 { transform: rotateY(-90deg) translateZ(40px); }
.face5 { transform: rotateX(90deg) translateZ(40px); }
.face6 { transform: rotateX(-90deg) translateZ(40px); }
</style>
</head>
<body>

<h1>ðŸ©¸ Presas Expostas</h1>

<!-- LOGIN -->
<div id="loginBox">
  <h2>Login</h2>
  <input id="email" placeholder="Email">
  <input id="senha" type="password" placeholder="Senha">
  <button onclick="login()">Entrar</button>
  <button onclick="registrar()">Criar Conta</button>
  <p id="loginErro"></p>
</div>

<!-- FICHA -->
<div id="fichaBox" class="hidden">
  <h2>Ficha do Personagem</h2>

  <input id="nome" placeholder="Nome do personagem">
  <textarea id="historia" placeholder="HistÃ³ria do personagem"></textarea>

  <h3>ðŸŽ² Pool de Dados</h3>
  <p>Dados Totais: <span id="dadosTotais">6</span></p>
  <button onclick="ganharDado()">Ganhar +1 Dado</button>

  <h3>ðŸŽ¯ Shots</h3>
  <p id="shots">0 / 3</p>
  <button onclick="addShot()">Adicionar Shot</button>

  <h3>ðŸ§  TensÃ£o</h3>
  <p id="tensao">0 / 10</p>

  <h3>ðŸŽ² Teste</h3>
  <input id="qtdDados" type="number" min="1" value="1">
  <button onclick="rolarTeste()">Rolar Dados</button>

  <div class="scene">
    <div class="cube" id="cube">
      <div class="face face1">1</div>
      <div class="face face2">2</div>
      <div class="face face3">3</div>
      <div class="face face4">4</div>
      <div class="face face5">5</div>
      <div class="face face6">6</div>
    </div>
  </div>

  <p id="resultadoDados"></p>

  <button onclick="salvarFicha()">Salvar Ficha</button>
  <button onclick="logout()">Sair</button>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyALP0nO2FneTe-qwKwC_mNlD5jzHMaPljo",
  authDomain: "rpg-campanha.firebaseapp.com",
  projectId: "rpg-campanha",
  appId: "1:1095737273808:web:9ab46ac71ba836825c1dd5"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

const params = new URLSearchParams(window.location.search);
const campaignId = params.get("id");
if (!campaignId) alert("Campanha nÃ£o encontrada");

let userUID;
let shots = 0;
let tensao = 0;
let dadosTotais = 6;

/* AUTH */
auth.onAuthStateChanged(user => {
  if (user) {
    userUID = user.uid;
    loginBox.classList.add("hidden");
    fichaBox.classList.remove("hidden");
    carregarFicha();
  }
});

/* LOGIN */
function login() {
  auth.signInWithEmailAndPassword(email.value, senha.value)
    .catch(e => loginErro.innerText = e.message);
}

function registrar() {
  auth.createUserWithEmailAndPassword(email.value, senha.value)
    .catch(e => loginErro.innerText = e.message);
}

function logout() {
  auth.signOut();
}

/* SHOTS */
function addShot() {
  shots++;
  if (shots >= 3) shots = 0;
  atualizarUI();
}

function ganharDado() {
  dadosTotais++;
  atualizarUI();
}

/* ðŸŽ² TESTE */
function rolarTeste() {
  let qtd = Math.min(parseInt(qtdDados.value), dadosTotais);
  let falhas = 0;
  let resultados = [];

  for (let i = 0; i < qtd; i++) {
    let d = Math.floor(Math.random() * 6) + 1;
    resultados.push(d);
    animarDado(d);
    if (d <= 2) falhas++;
  }

  tensao = Math.min(10, tensao + falhas);
  dadosTotais = Math.max(0, dadosTotais - falhas);

  resultadoDados.innerText =
    `Resultados: ${resultados.join(", ")} | Falhas: ${falhas}`;

  atualizarUI();
}

/* ðŸŽ² ANIMAÃ‡ÃƒO */
function animarDado(valor) {
  const cube = document.getElementById("cube");
  const rot = {
    1:"rotateX(0deg) rotateY(0deg)",
    2:"rotateY(-90deg)",
    3:"rotateY(180deg)",
    4:"rotateY(90deg)",
    5:"rotateX(-90deg)",
    6:"rotateX(90deg)"
  };
  cube.style.transform = rot[valor];
}

/* SALVAR */
function salvarFicha() {
  db.collection("campaigns")
    .doc(campaignId)
    .collection("players")
    .doc(userUID)
    .set({
      nome: nome.value,
      historia: historia.value,
      shots,
      tensao,
      dadosTotais
    });
  alert("Ficha salva!");
}

function carregarFicha() {
  db.collection("campaigns")
    .doc(campaignId)
    .collection("players")
    .doc(userUID)
    .get().then(doc => {
      if (doc.exists) {
        const d = doc.data();
        nome.value = d.nome || "";
        historia.value = d.historia || "";
        shots = d.shots || 0;
        tensao = d.tensao || 0;
        dadosTotais = d.dadosTotais ?? 6;
        atualizarUI();
      }
    });
}

function atualizarUI() {
  document.getElementById("shots").innerText = shots + " / 3";
  document.getElementById("tensao").innerText = tensao + " / 10";
  document.getElementById("dadosTotais").innerText = dadosTotais;
}
</script>

</body>
</html>

